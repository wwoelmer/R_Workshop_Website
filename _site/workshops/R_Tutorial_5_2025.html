<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Whitney Woelmer">

<title>BOPRC R Tutorial 5 - Statistical Analyses in R – Introduction to R Workshop Series</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-df479d6c4d77d0e0dfbcb5361179d7fd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Introduction to R Workshop Series</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/R_Tutorial_1_2025.html"> 
<span class="menu-text">Lesson 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/R_Tutorial_2_2025.html"> 
<span class="menu-text">Lesson 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/R_Tutorial_3_2025.html"> 
<span class="menu-text">Lesson 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/R_Tutorial_4_2025.html"> 
<span class="menu-text">Lesson 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../workshops/R_Tutorial_5_2025.html" aria-current="page"> 
<span class="menu-text">Lesson 5</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/R_Tutorial_6_2025.html"> 
<span class="menu-text">Lesson 6</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#correlation-analysis-and-plots" id="toc-correlation-analysis-and-plots" class="nav-link" data-scroll-target="#correlation-analysis-and-plots"><span class="header-section-number">2</span> Correlation analysis and plots</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression"><span class="header-section-number">3</span> Linear regression</a></li>
  <li><a href="#testing-for-statistical-differences-between-variables" id="toc-testing-for-statistical-differences-between-variables" class="nav-link" data-scroll-target="#testing-for-statistical-differences-between-variables"><span class="header-section-number">4</span> Testing for statistical differences between variables</a>
  <ul class="collapse">
  <li><a href="#t-test" id="toc-t-test" class="nav-link" data-scroll-target="#t-test"><span class="header-section-number">4.1</span> T-test</a></li>
  <li><a href="#wilcoxon-rank-sum" id="toc-wilcoxon-rank-sum" class="nav-link" data-scroll-target="#wilcoxon-rank-sum"><span class="header-section-number">4.2</span> Wilcoxon rank sum</a></li>
  <li><a href="#anova" id="toc-anova" class="nav-link" data-scroll-target="#anova"><span class="header-section-number">4.3</span> ANOVA</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">BOPRC R Tutorial 5 - Statistical Analyses in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Whitney Woelmer </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<p>This lesson is designed to provide you with experience in running statistical analyses in R. We will use water quality data as an example, but these analyses can be applied to many other datasets, provided the statistical assumptions are met. We will cover the following topics:</p>
<ul>
<li>Correlation analyses (Pearson and Spearman) and plots</li>
<li>Linear regression and plots</li>
<li>T-tests and Wilcoxon rank sum test (aka Mann-Whitney)</li>
<li>ANOVA</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Disclaimer</strong></p>
<p>This lesson teaches the implementation of multiple statistical analyses, rather than the background behind why, when, and what to check when choosing a statistical analysis. You should always check the underlying assumptions of an analysis and whether your data meet those assumptions.</p>
</div>
</div>
<p>We are adding a few new packages today which perform specialized functions for statistical analyses. You don’t need to worry about the new packages too much, other than you will need to install and load the libraries.</p>
<p>The main packages that we will use in this tutorial are:</p>
<ul>
<li><strong>tidyverse</strong></li>
<li><strong>lubridate</strong></li>
<li><strong>Hmisc</strong></li>
<li><strong>corrplot</strong></li>
<li><strong>ggpmisc</strong></li>
<li><strong>ggpubr</strong></li>
</ul>
<p>Before attempting to install these packages, make sure your Primary CRAN Repository is set to:</p>
<ul>
<li><strong>“New Zealand [https] - University of Auckland”</strong></li>
</ul>
<p>To check this, click ‘Tools’ –&gt; ‘Global Options’ –&gt; ‘Packages’. Click ‘Change’ if you need to adjust this.</p>
<p>You can download most packages by clicking on the ‘Install’ button on the ‘packages’ tab in the lower right window pane. Then in the Install Packages popup, select ‘Repository (CRAN)’ from the ‘Install from’ drop box and type the name of the package you wish to download (e.g., dplyr).</p>
<p>Once all of these packages are installed you can load them using the <code>library</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyverse' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpmisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggpmisc' was built under R version 4.4.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggpp' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First we will load in our data. We will use the same water quality data from Lesson 3. This data has been downloaded from Aquarius using the R script which you can find at <code>scripts/download_data_aquarius.R</code> if you’d like to see how the data were downloaded. For today, we are skipping that step and reading in directly from a .csv file which was written after the Aquarius download.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>wq <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'./data/Lake_WQ_Timeseries.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, look at the <code>wq</code> dataframe by clicking on it in the environment and familiarise yourself with the columns. You can also run the function <code>colnames(wq)</code> in the console to get a list of column names. It’s better to run this in the console (rather than in your script editor), since it is a diagnostic test and not something you will necessary need to run every time you open your script–just as needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(wq) <span class="co"># you don't have to save this in your script, but can copy it into the console</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Site"                "LocationName"        "Time"               
 [4] "Value"               "Quality"             "Approval"           
 [7] "Qualifiers"          "Parameter"           "Unit"               
[10] "Sample_Number"       "Project_Id"          "LowerDetectionLimit"
[13] "UpperDetectionLimit" "Method"              "CollectionMethod"   
[16] "Lab"                 "Error"               "Comment"            
[19] "ACTION"              "Samp_Comment"        "Cloud_Cover"        
[22] "Num_Swimmers"        "Tide_Cycle"          "Tide"               
[25] "Wind_Direction"      "Wind_Speed"          "Weather_Today"      
[28] "Weather_Yest"        "Surface_Cond"        "Bore_Type"          
[31] "Bore_Number"         "Bore_Collect_Method" "Bore_Sampled_From"  
[34] "Bore_Pump_Rate"      "Bore_Pump_Duration"  "Bore_Protocol"      
[37] "Bore_Probe"          "Odour"              </code></pre>
</div>
</div>
<p>As we know from previous lessons, it is always best practice is to format date/time objects with the appropriate timezone, otherwise R will assume a timezone, and that can lead to the wrong date being set for your timestamp. This is the first thing I do when I see I have a datetime object as a column. Let’s use a bit of code that will parse our <code>Time</code> column, which includes both a date and a time.</p>
<p>Here, we will use a function called <code>parse_date_time</code> which looks at the <code>Time</code> column, and then provides a list (using <code>c()</code>) of potential formats that the column will be in. Here, we list two formats, the first one has YMD and HMS (hours, minutes, seconds), the second one just has YMD, as some of the values in the <code>Time</code> column don’t have an associated time next to the date. We pair this with the <code>mutate</code> function to re-write our <code>Time</code> column.</p>
<p>NOTE: there are many ways to format/parse dates and times in R. This is just one example!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>wq <span class="ot">&lt;-</span> wq <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Time =</span> <span class="fu">parse_date_time</span>(Time,<span class="fu">c</span>(<span class="st">"%Y-%m-%d %H:%M:%S"</span>,<span class="st">"%Y-%m-%d"</span>), <span class="at">tz =</span> <span class="st">"etc/GMT+12"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><strong><em>Challenge 1:</em></strong> <em>What locations and parameters are included in this dataset? Use the <code>unique()</code> function to find out.</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(wq<span class="sc">$</span>Parameter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TN (g/m^3)"    "TP (g/m^3)"    "CHLA (mg/m^3)" "VC - SD (m)"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(wq<span class="sc">$</span>LocationName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Lake Rotoma at Site 1 (Integrated)"       
 [2] "Lake Rotoehu at Site 3 (Integrated)"      
 [3] "Lake Rotoiti at Site 4 (Integrated)"      
 [4] "Lake Rotoiti at Site 3 (Integrated)"      
 [5] "Lake Rotoiti at Okawa Bay (Integrated)"   
 [6] "Lake Rotorua at Site 2 (Integrated)"      
 [7] "Lake Okataina at Site 1 (Integrated)"     
 [8] "Lake Okareka at Site 1 (Integrated)"      
 [9] "Lake Tikitapu at Site 1 (Integrated)"     
[10] "Lake Rerewhakaaitu at Site 1 (Integrated)"
[11] "Lake Okaro at Site 1 (Integrated)"        
[12] "Lake Rotorua at Site 5 (Integrated)"      
[13] "Lake Tarawera at Site 5 (Integrated)"     
[14] "Lake Rotomahana at Site 2 (Integrated)"   </code></pre>
</div>
</div>
</details>
<hr>
<p>That helps us get a better understanding of the dataset that we’re working with and is something I will do often while working in R to remind myself.</p>
<p>Since we are going to do correlation analysis first, let’s focus on just one site and look at the relationships between variables in the <code>Parameter</code> column. We will filter the data to only select “Lake Okaro at Site 1 (Integrated)” and we will create a new dataframe named <code>wq_okaro</code> so we keep all the other lake data in the <code>wq</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>wq_okaro <span class="ot">&lt;-</span> wq <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LocationName<span class="sc">==</span><span class="st">'Lake Okaro at Site 1 (Integrated)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also clean up the dataframe and only select the columns which are useful to us right now</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>wq_okaro <span class="ot">&lt;-</span> wq_okaro <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Time, Value, Parameter, Unit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s plot the data to make sure everything looks good. I like to do a <code>geom_point</code> plot, as well as a histogram, using <code>geom_histogram</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wq_okaro, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.POSIXct</span>(Time), <span class="at">y =</span> Value, <span class="at">color =</span> Parameter)) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Parameter, <span class="at">scales =</span> <span class="st">'free'</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Time'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wq_okaro, <span class="fu">aes</span>(<span class="at">x =</span> Value, <span class="at">fill =</span> Parameter)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Parameter, <span class="at">scales =</span> <span class="st">'free'</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alright, we have a time series of four variables. There are many things we can do to analyse this data. Let’s start with a correlation analysis.</p>
</section>
<section id="correlation-analysis-and-plots" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Correlation analysis and plots</h1>
<p>A correlation analysis is used to assess the magnitude and direction of the relationship between two variables. It does not necessarily imply casuation, but shows you how two variables change together.</p>
<p>We will use the function <code>rcorr</code> and <code>corrplot</code> to create and visualize our correlation analysis. In order to conduct a correlation analysis, we need to do some formatting/rearranging. First, we need to make the data wide, but we also have to create a <code>Date</code> column which doesn’t include the time so that it is common across the variables. We will also remove the <code>Unit</code> column for this reason (and we don’t need that column for this anyway since the units are stored in the Parameter names)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>okaro_wide <span class="ot">&lt;-</span> wq_okaro <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Time)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Time, <span class="sc">-</span>Unit) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Date, Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Value =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">'Parameter'</span>, <span class="at">values_from =</span> <span class="st">'Value'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Open up your new <code>okaro_wide</code> data and check it out. Those column names have gaps and symbols in them, which might cause us problems later. Let’s rename the columns using the function <code>rename</code>. I’ll show you one example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>okaro_wide <span class="ot">&lt;-</span> okaro_wide <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'chla_mgm3'</span> <span class="ot">=</span> <span class="st">"CHLA (mg/m^3)"</span>) <span class="co"># the format is new name = old name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><strong><em>Challenge 2:</em></strong> <em>Rename the remaining variable columns to TN_gm3, TP_gm3, and secchi_m.</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>okaro_wide <span class="ot">&lt;-</span> okaro_wide <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">TN_gm3 =</span> <span class="st">"TN (g/m^3)"</span>, <span class="at">TP_gm3 =</span> <span class="st">"TP (g/m^3)"</span>, <span class="at">secchi_m =</span> <span class="st">"VC - SD (m)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<hr>
<p>Great, your <code>okaro_wide</code> dataframe should now have the columns <code>Date</code>, <code>chla_mgm3</code>, <code>TN_gm3</code>, <code>TP_gm3</code>, and <code>secchi_m.</code></p>
<p>The next thing we need to do in order to run the correlation analysis is to remove the <code>Date</code> column. We aren’t interested in how date is correlated with chl-a, TN, TP, or secchi (for this analysis!). Just how they are correlated with each other.</p>
<hr>
<p><strong><em>Challenge 3:</em></strong> <em>Use the <code>select</code> function to remove the Date column. Make this a new dataframe called <code>okaro_corr</code>.</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>okaro_corr <span class="ot">&lt;-</span> okaro_wide <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<hr>
<p>Now we have to make sure there are no NA’s in the data frame, and format it as a matrix. This is simply because the function which runs the correlation analysis, <code>rcorr</code>, is picky, so we have to make it happy :) <code>rcorr</code> requires the format of the input to be a matrix, which is a two-dimensional data structure that organizes elements into rows and columns. This is slightly different from a dataframe, which is what we usually use, in that each element in a matrix must be of the same data type, making it a homogenous structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>okaro_corr <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(okaro_corr)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># note that the function complete.cases() also will do the same trick here</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>okaro_corr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(okaro_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s run the correlation analysis using the <code>rcorr</code> function. The default type of analysis is Pearson, which assumes normality. Here, we will specify Spearman because our data are not all normally distributed (as we learned in our histogram plot earlier).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>okaro_corr_out <span class="ot">&lt;-</span> <span class="fu">rcorr</span>(okaro_corr, <span class="at">type =</span> <span class="st">"spearman"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(okaro_corr_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          chla_mgm3 TN_gm3 TP_gm3 secchi_m
chla_mgm3      1.00   0.69   0.54    -0.75
TN_gm3         0.69   1.00   0.72    -0.65
TP_gm3         0.54   0.72   1.00    -0.46
secchi_m      -0.75  -0.65  -0.46     1.00

n= 91 


P
          chla_mgm3 TN_gm3 TP_gm3 secchi_m
chla_mgm3            0      0      0      
TN_gm3     0                0      0      
TP_gm3     0         0             0      
secchi_m   0         0      0             </code></pre>
</div>
</div>
<p>Let’s look at that output! The first table is the correlation coefficients (r) and the second is the p-values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>p_mat <span class="ot">&lt;-</span> okaro_corr_out<span class="sc">$</span>P  <span class="co"># this is the matrix of p_values</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(p_mat) <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># because there are no p-values on the diagonals, we have to insert 1 here for the plot to work</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(okaro_corr_out<span class="sc">$</span>r, <span class="at">type =</span> <span class="st">"upper"</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="at">insig =</span> <span class="st">"blank"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.mat =</span> p_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are lots of ways to cusotmize these plots. You can check them out by googling <code>corrplot</code> and seeing what others have done and running <code>?corrplot</code> in the console to see what some of the different arguments do. Let’s say we want to actually see what the correlation coefficients are on the plot.</p>
<hr>
<p><strong><em>Challenge 4:</em></strong> <em>Remake the plot but add the argument <code>addCoef.col = "black"</code> to display the p-values within each circle.</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(okaro_corr_out<span class="sc">$</span>r, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">'upper'</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sig.level =</span> <span class="fl">0.05</span>, </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">"black"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">insig =</span> <span class="st">'blank'</span>, </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">p.mat =</span> p_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</details>
<hr>
<hr>
<p><strong><em>Challenge 3:</em></strong> <em>Repeat the correlation analysis for Lake Tarawera. How do the correlations compare between the two lakes? Remember, you need to first subset the <code>wq</code> dataframe for Lake Tarawera, then <code>pivot_wider</code> so your columns are your variables, <code>rename</code> your columns to get rid of symbols and spaces, remove the <code>Date</code> column and any NA’s, then run your correlation using <code>rcorr</code>, and then plot your output using <code>corrplot</code>!</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>wq_tara <span class="ot">&lt;-</span> wq <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(LocationName<span class="sc">==</span><span class="st">'Lake Tarawera at Site 5 (Integrated)'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Time, Value, Parameter, Unit)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>tara_wide <span class="ot">&lt;-</span> wq_tara <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Time)) <span class="sc">%&gt;%</span> <span class="co"># keeping these lines in our workflow to remove Time and Unit</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Time, <span class="sc">-</span>Unit) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Date, Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Value =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">'Parameter'</span>, <span class="at">values_from =</span> <span class="st">'Value'</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>tara_wide <span class="ot">&lt;-</span> tara_wide <span class="sc">%&gt;%</span> </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'chla_mgm3'</span> <span class="ot">=</span> <span class="st">"CHLA (mg/m^3)"</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">'TN_gm3'</span> <span class="ot">=</span> <span class="st">"TN (g/m^3)"</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">"TP_gm3"</span> <span class="ot">=</span> <span class="st">"TP (g/m^3)"</span>,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">"secchi_m"</span> <span class="ot">=</span> <span class="st">"VC - SD (m)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(<span class="sc">-</span>Date)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>tara_corr <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(tara_wide)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>tara_corr_out <span class="ot">&lt;-</span> <span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(tara_corr), <span class="at">type =</span> <span class="st">'spearman'</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>p_mat <span class="ot">&lt;-</span> tara_corr_out<span class="sc">$</span>P <span class="co"># this is the matrix of p_values</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(p_mat) <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># because there are no p-values on the diagonals, we have to insert 1 here for the plot to </span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(tara_corr_out<span class="sc">$</span>r, </span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">'upper'</span>,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">sig.level =</span> <span class="fl">0.05</span>, </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">insig =</span> <span class="st">'blank'</span>, </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">'black'</span>,</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">p.mat =</span> p_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</details>
<hr>
<p>Between Lakes Okaro and Tarawera, we can now see that there are differences in both the strength of correlations, and in what correlations are significant. For example, in Lake Okaro, all the variables show significant correlations, with the strongest relationship between Secchi depth and chl-a (-0.75). In contrast, in Lake Tarawera, only chl-a and TN; TN and secchi; and chl-a and TN are significantly related, and the relationships are much weaker. There are lots of reasons we can dig into here, but a big driver of these different relationships is likely tied to differences in size, trophic state, and catchment characteristics!</p>
</section>
<section id="linear-regression" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Linear regression</h1>
<p>Next, we will conduct linear regression between two variables which we think are causally related.</p>
<p>Based on our correlation plots above, let’s do this for chl-a and TN in Lake Okaro which have a strong, positive correlation. We will go back to our <code>okaro_wide</code> dataframe for this, which we created earlier. We will use the function <code>lm()</code> to conduct linear regression. Then, we use <code>summary()</code> to shows us the results of the model. We can also run <code>plot(model)</code> to show the residuals of the model and help check out some diagnostics of the model fit.</p>
<p>To plot the linear regression output, we will create a plot with TN on the x-axis and chl-a on the y-axis using <code>geom_point</code> like we ususally do. however, we will also use the function <code>geom_smooth(method = 'lm')</code> which adds a ‘smoothed’ line corresponding to a linear model (that is what the abbrevation ‘lm’ means). We will pair this with the function <code>stat_poly_eq</code> which allows you to also add the statistical output to the plot. You can customize what information you want to show up (equation, listed as <code>..eq.label..</code>, r-squared, listed as <code>..rr.label..</code>, etc.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(okaro_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Date       chla_mgm3 TN_gm3 TP_gm3 secchi_m
  &lt;date&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
1 2015-01-22     23.1   0.900 0.0250    0.850
2 2015-02-19      1.4   0.37  0.0110    3.42 
3 2015-03-19      4.40  0.400 0.0170    4.07 
4 2015-04-16      4.60  0.335 0.0122    6.05 
5 2015-05-21      5.10  0.583 0.023     7.15 
6 2015-06-23      4     0.920 0.0595    7.35 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(chla_mgm3 <span class="sc">~</span> TN_gm3, <span class="at">data =</span> okaro_wide)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = chla_mgm3 ~ TN_gm3, data = okaro_wide)

Residuals:
    Min      1Q  Median      3Q     Max 
-35.058  -7.923   0.629   6.175  61.660 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -19.278      3.715   -5.19 1.21e-06 ***
TN_gm3        55.804      5.098   10.95  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.11 on 94 degrees of freedom
  (39 observations deleted due to missingness)
Multiple R-squared:  0.5604,    Adjusted R-squared:  0.5557 
F-statistic: 119.8 on 1 and 94 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-18-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-18-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(okaro_wide, <span class="fu">aes</span>(<span class="at">x =</span> TN_gm3, <span class="at">y =</span> chla_mgm3)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">stat_poly_eq</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..eq.label.., ..rr.label..,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    ..p.value.label.., <span class="at">sep =</span> <span class="st">"~~~"</span>))) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="fu">expression</span>(Chl <span class="sc">*</span> <span class="st">"-a"</span> <span class="sc">~</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    (mg<span class="sc">/</span>m<span class="sc">^</span><span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..eq.label..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(eq.label)` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 39 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 39 rows containing non-finite outside the scale range
(`stat_poly_eq()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 39 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-18-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Well, that was easy! We have our summary statistics and a nice plot with our linear regression. The <code>summary(model)</code> shows that both the intercept and slope are significant and our adjusted R-squared is 0.56. However, it’s always good to plot some diagnostics of statistical models and make sure that the proper assumptions are being met.</p>
<p>Let’s look at our residuals. Remember for a linear regression, our residuals should be normally distributed. We will use the function <code>shapiro.test</code> which tests for normality. If the p-value of the Shapiro-Wilk is less than 0.05, that indicates that the variable is <em>not</em> normally distributed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resid
W = 0.9152, p-value = 1.157e-05</code></pre>
</div>
</div>
<p>Uh oh, the Shapiro-Wilk test returns a p-value of &lt; 0.05, which means our residuals are not normally distributed and we have violated the assumptions of the linear regression–not good! We can address this by transforming our data to try and achieve a normal distribution of the residuals. Typically, you can try by first transforming the response variable, in our case chl-a.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(chla_mgm3) <span class="sc">~</span> TN_gm3, <span class="at">data =</span> okaro_wide)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(chla_mgm3) ~ TN_gm3, data = okaro_wide)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.99807 -0.49331 -0.02981  0.61071  1.61268 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.7974     0.1815   4.395 2.91e-05 ***
TN_gm3        2.2160     0.2490   8.899 4.03e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7869 on 94 degrees of freedom
  (39 observations deleted due to missingness)
Multiple R-squared:  0.4573,    Adjusted R-squared:  0.4515 
F-statistic: 79.19 on 1 and 94 DF,  p-value: 4.028e-14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-20-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-20-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resid
W = 0.99111, p-value = 0.7761</code></pre>
</div>
</div>
<p>Viola, that looks much better–our p-value is 0.78 after log-transforming chl-a, which indicates that the residuals are normally distributed and the assumptions of a linear regression have been met. Let’s also update our plot with the new model and log transform the y-axis</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(okaro_wide, <span class="fu">aes</span>(<span class="at">x =</span> TN_gm3, <span class="at">y =</span> <span class="fu">log</span>(chla_mgm3))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">stat_poly_eq</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..eq.label.., ..rr.label..,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    ..p.value.label.., <span class="at">sep =</span> <span class="st">"~~~"</span>))) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="fu">expression</span>(Log <span class="sc">~</span> Chl <span class="sc">*</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"-a"</span> <span class="sc">~</span> (mg<span class="sc">/</span>m<span class="sc">^</span><span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 39 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 39 rows containing non-finite outside the scale range
(`stat_poly_eq()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 39 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p><strong><em>Challenge 4:</em></strong> <em>Repeat the linear regression analysis, this time between chl-a and secchi depth at Lake Okaro. Make a similar plot with <code>geom_smooth</code> and add the equation, R2, and p-value to the plot. Test to see if the residuals are normally distributed and re-adjust your model and plot accordingly.</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(okaro_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Date       chla_mgm3 TN_gm3 TP_gm3 secchi_m
  &lt;date&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
1 2015-01-22     23.1   0.900 0.0250    0.850
2 2015-02-19      1.4   0.37  0.0110    3.42 
3 2015-03-19      4.40  0.400 0.0170    4.07 
4 2015-04-16      4.60  0.335 0.0122    6.05 
5 2015-05-21      5.10  0.583 0.023     7.15 
6 2015-06-23      4     0.920 0.0595    7.35 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(chla_mgm3) <span class="sc">~</span> secchi_m, <span class="at">data =</span> okaro_wide)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(chla_mgm3) ~ secchi_m, data = okaro_wide)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.00524 -0.37442 -0.04635  0.46178  2.92624 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.69277    0.17683  20.883  &lt; 2e-16 ***
secchi_m    -0.39505    0.04288  -9.212  9.5e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7694 on 93 degrees of freedom
  (40 observations deleted due to missingness)
Multiple R-squared:  0.4771,    Adjusted R-squared:  0.4715 
F-statistic: 84.86 on 1 and 93 DF,  p-value: 9.498e-15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-22-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>resid2 <span class="ot">&lt;-</span> <span class="fu">resid</span>(model2)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(resid2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-22-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(resid2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resid2
W = 0.97526, p-value = 0.06868</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(okaro_wide, <span class="fu">aes</span>(<span class="at">x =</span> secchi_m, <span class="at">y =</span> <span class="fu">log</span>(chla_mgm3))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">stat_poly_eq</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(..eq.label.., ..rr.label..,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    ..p.value.label.., <span class="at">sep =</span> <span class="st">"~~~"</span>))) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Secchi depth (m)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="fu">expression</span>(Log <span class="sc">~</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    Chl <span class="sc">*</span> <span class="st">"-a"</span> <span class="sc">~</span> (mg<span class="sc">/</span>m<span class="sc">^</span><span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 40 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 40 rows containing non-finite outside the scale range
(`stat_poly_eq()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 40 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-22-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</details>
<hr>
</section>
<section id="testing-for-statistical-differences-between-variables" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Testing for statistical differences between variables</h1>
<p>In our next example, we are going to test if there is a statistical difference between two sets of data. We often need to do this in ecology and environmental science for a number of reasons. For example, is the community composition at one site different from another?</p>
<p>In our case, we will test to see if the distribution of a given water quality variable is different between lakes or sites.</p>
<p>Let’s test to see if the data collected at Okawa Bay in the shallower western bay of lake Rotoiti, is significantly different from data collected at Site 4 in Lake Rotoiti, in the much deeper eastern bay of the lake. This will tell us something about how spatially heterogeneous Lake Rotoiti is. Let’s focus on chl-a dynamics, as this relates to algal blooms and is of direct societal relevance.</p>
<p>First, we need to do a little data manipulating to get the data for our two sites in the right format. We will go back to our original <code>wq</code> dataset, select the relevant columns, and filter for our two sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>wq_rotoiti <span class="ot">&lt;-</span> wq <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Time, LocationName, Value, Parameter, Unit) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(LocationName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lake Rotoiti at Okawa Bay (Integrated)"</span>, <span class="st">"Lake Rotoiti at Site 4 (Integrated)"</span>))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wq_rotoiti)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Time                        LocationName Value  Parameter
1 2015-07-21 13:45:00 Lake Rotoiti at Site 4 (Integrated) 0.176 TN (g/m^3)
2 2015-08-18 10:45:00 Lake Rotoiti at Site 4 (Integrated) 0.156 TN (g/m^3)
3 2015-09-15 11:50:00 Lake Rotoiti at Site 4 (Integrated) 0.148 TN (g/m^3)
4 2015-10-20 00:00:00 Lake Rotoiti at Site 4 (Integrated) 0.154 TN (g/m^3)
5 2015-11-17 11:45:00 Lake Rotoiti at Site 4 (Integrated) 0.181 TN (g/m^3)
6 2015-12-15 10:55:00 Lake Rotoiti at Site 4 (Integrated) 0.199 TN (g/m^3)
   Unit
1 g/m^3
2 g/m^3
3 g/m^3
4 g/m^3
5 g/m^3
6 g/m^3</code></pre>
</div>
</div>
<hr>
<p><strong><em>Challenge 5:</em></strong> <em>From the <code>Parameter</code> column, we need to select just the chl-a data. Filter the new dataset <code>wq_rotoiti</code> so that the only Parameter is chla.</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(wq_rotoiti<span class="sc">$</span>Parameter)  <span class="co"># first look at what the values are in this column, then copy the one you need</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TN (g/m^3)"    "TP (g/m^3)"    "CHLA (mg/m^3)" "VC - SD (m)"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>wq_rotoiti <span class="ot">&lt;-</span> wq_rotoiti <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"CHLA (mg/m^3)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<hr>
<p>Now that we have filtered for our sites and for chl-a, we will <code>pivot_wider</code> so our site names are in separate columns. Similar to when we used <code>pivot_wider</code> for Okaro and Tarawera above, we first need to create a <code>Date</code> column (since the time of sample collection is not relevant here), and remove the <code>Unit</code> column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>rotoiti_wide <span class="ot">&lt;-</span> wq_rotoiti <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Time)) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Time, <span class="sc">-</span>Unit) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Date, LocationName, Parameter) <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Value =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"LocationName"</span>, <span class="at">values_from =</span> <span class="st">"Value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rotoiti_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  Date       Parameter     Lake Rotoiti at Okawa Bay (I…¹ Lake Rotoiti at Site…²
  &lt;date&gt;     &lt;chr&gt;                                  &lt;dbl&gt;                  &lt;dbl&gt;
1 2015-01-20 CHLA (mg/m^3)                          15.6                      NA
2 2015-02-17 CHLA (mg/m^3)                           7.40                     NA
3 2015-03-18 CHLA (mg/m^3)                         117                        NA
4 2015-04-14 CHLA (mg/m^3)                           4                        NA
5 2015-05-19 CHLA (mg/m^3)                           1.9                      NA
6 2015-06-16 CHLA (mg/m^3)                           3.8                      NA
# ℹ abbreviated names: ¹​`Lake Rotoiti at Okawa Bay (Integrated)`,
#   ²​`Lake Rotoiti at Site 4 (Integrated)`</code></pre>
</div>
</div>
<hr>
<p><strong><em>Challenge 6:</em></strong> <em>Ok, our data frame has the columns <code>Date</code>, <code>Parameter</code>, and one for each site at Rotoiti. We don’t actually need the Parameter column anymore, since it’s only chl-a, so let’s remove that. But, let’s rename our site columns to 1) avoid spaces in the column names, and 2) add ‘chl-a’ into the column name so we don’t lose track of what data we are working with. Rename the new columns <code>OkawaBay_chla</code> and <code>Site4_chla</code></em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>rotoiti_wide <span class="ot">&lt;-</span> rotoiti_wide <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Parameter) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">OkawaBay_chla =</span> <span class="st">"Lake Rotoiti at Okawa Bay (Integrated)"</span>, <span class="at">Site4_chla =</span> <span class="st">"Lake Rotoiti at Site 4 (Integrated)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<hr>
<p>Next, we need to check if chl-a and TN are normally distributed, which is a requirement for t-tests. You might already have a guess at how this will go based on our <code>shapiro.test</code> results from the linear regression, but here, instead of testing the residuals of our model for normality, we are testing the original data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(rotoiti_wide<span class="sc">$</span>OkawaBay_chla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  rotoiti_wide$OkawaBay_chla
W = 0.62199, p-value = 9.098e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(rotoiti_wide<span class="sc">$</span>Site4_chla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  rotoiti_wide$Site4_chla
W = 0.886, p-value = 1.249e-07</code></pre>
</div>
</div>
<p>Both sites have a very small p-value, which means they fail the Shapiro-Wilks normality test so, if we want to use a t-test we will need to transform them. Log-transformation is one common way to do this, like we did above with chl-a data at Lake Okaro. We will also look at a histogram of the logged values to visually examine normality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">log</span>(rotoiti_wide<span class="sc">$</span>OkawaBay_chla))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  log(rotoiti_wide$OkawaBay_chla)
W = 0.98838, p-value = 0.4324</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">log</span>(rotoiti_wide<span class="sc">$</span>Site4_chla))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  log(rotoiti_wide$Site4_chla)
W = 0.98987, p-value = 0.5942</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(rotoiti_wide<span class="sc">$</span>OkawaBay_chla))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(rotoiti_wide<span class="sc">$</span>Site4_chla))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Great, things are looking pretty “normal” after log-transformation, so we are good to go ahead and run a t-test.</p>
<p><strong><em>NOTE</em></strong> <em>: there is a package called <code>bestNormalize</code> which runs a series of noramlisation tests and allows you to pick the best transformation for your data. This can be a useful tool for figuring out which type of normalization to use (log, sqaure root, etc.), especially if your data do not easily normalize with a log transformation. However, we will not go into details on how to use this package today as a log transformation works well in our case, just want you to be aware of it for future use!</em></p>
<section id="t-test" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="t-test"><span class="header-section-number">4.1</span> T-test</h2>
<p>Let’s also create a boxplot which will show the distributions of data at each site. We will need to <code>pivot_longer</code> again to show the boxplots with the sites on the x-axis, so we will do this in the tidyverse pipe style, without creating a new object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">log</span>(rotoiti_wide<span class="sc">$</span>OkawaBay_chla), <span class="fu">log</span>(rotoiti_wide<span class="sc">$</span>Site4_chla), <span class="at">paired =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  log(rotoiti_wide$OkawaBay_chla) and log(rotoiti_wide$Site4_chla)
t = 8.5839, df = 65, p-value = 2.689e-12
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 0.6182031 0.9930897
sample estimates:
mean difference 
      0.8056464 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>rotoiti_wide <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(OkawaBay_chla<span class="sc">:</span>Site4_chla, <span class="at">names_to =</span> <span class="st">"Site"</span>, <span class="at">values_to =</span> <span class="st">"Chla"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Site, <span class="at">y =</span> <span class="fu">log</span>(Chla), <span class="at">fill =</span> Site)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Log Chl-a"</span>) <span class="sc">+</span> <span class="fu">stat_compare_means</span>(<span class="at">method =</span> <span class="st">"t.test"</span>, <span class="at">label =</span> <span class="st">"p.format"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 92 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 92 rows containing non-finite outside the scale range
(`stat_compare_means()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The results of our t-test show that these two sites are significantly different from each other. This isn’t too surprising given that Okawa Bay is a much shallower, isolated bay on the western end of Lake Rotoiti, while Site 4 is located in the much deeper main basin. Visually inspecting the boxplots also supports this. Cool!</p>
</section>
<section id="wilcoxon-rank-sum" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="wilcoxon-rank-sum"><span class="header-section-number">4.2</span> Wilcoxon rank sum</h2>
<p>Now, let’s say we didn’t want to log-transform our data. We can use non-parametric statistical tests to look for differences between non-normally distributed datasets. We will use the Wilcoxon rank sum test for this (sometimes called the Mann-Whitney test).</p>
<p>Let’s run the test using the <code>wilcoxon.test</code> function, and also create our boxplot figure. We will use the argument <code>paired = TRUE</code> in our Wilcoxon test because these samples were taken at roughly the same time and are expected to be representative of similar conditions at both sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(rotoiti_wide<span class="sc">$</span>OkawaBay_chla, rotoiti_wide<span class="sc">$</span>Site4_chla, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  rotoiti_wide$OkawaBay_chla and rotoiti_wide$Site4_chla
V = 2046.5, p-value = 1.877e-09
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>rotoiti_wide <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(OkawaBay_chla<span class="sc">:</span>Site4_chla, <span class="at">names_to =</span> <span class="st">"Site"</span>, <span class="at">values_to =</span> <span class="st">"Chla"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Site, <span class="at">y =</span> Chla, <span class="at">fill =</span> Site)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_compare_means</span>(<span class="at">method =</span> <span class="st">"wilcox.test"</span>, <span class="at">label =</span> <span class="st">"p.format"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 92 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 92 rows containing non-finite outside the scale range
(`stat_compare_means()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>With the Wilcoxon rank sum test on our raw data, we also show that there is a statistical difference between these two sites. Pretty cool to see that two locations within the same lake are significantly different from each!</p>
<p>__</p>
<p><strong><em>Challenge 7:</em></strong> <em>Run either a t-test or a Wilcoxon rank sum test to test if there is a significant difference between Lake Rotoiti at Site 4 and Lake Rotorua at Site 5. You can choose whichever water quality variable you’d like to look at. Remember, you will need to start with the <code>wq</code> dataframe, select the relevant columns, filter LocationName and Parameter. Then you will pivot_wider (don’t forget to make a Date column and remove Unit), rename your columns, and run your statistical test plus a plot! HINT: Samples are not collected on the same date between Rotorua and Rotoiti, so you will need to format your dates as Month-Year (e.g., Jan-2021). You can do this using this line of code within your tidyverse pipe: <code>mutate(Date = format(as.Date(Time), format = '%b-%Y'))</code></em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>rotoiti_rotorua <span class="ot">&lt;-</span> wq <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Time, LocationName, Value, Parameter, Unit) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(LocationName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lake Rotorua at Site 5 (Integrated)"</span>, <span class="st">"Lake Rotoiti at Site 4 (Integrated)"</span>),</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>        Parameter <span class="sc">==</span> <span class="st">"TP (g/m^3)"</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>rotoiti_rotorua_wide <span class="ot">&lt;-</span> rotoiti_rotorua <span class="sc">%&gt;%</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(Time), <span class="at">format =</span> <span class="st">"%b-%Y"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Time, <span class="sc">-</span>Unit) <span class="sc">%&gt;%</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Date, LocationName, Parameter) <span class="sc">%&gt;%</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Value =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"LocationName"</span>, <span class="at">values_from =</span> <span class="st">"Value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>rotoiti_rotorua_wide <span class="ot">&lt;-</span> rotoiti_rotorua_wide <span class="sc">%&gt;%</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Parameter) <span class="sc">%&gt;%</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Rotoiti_TP =</span> <span class="st">"Lake Rotoiti at Site 4 (Integrated)"</span>, <span class="at">Rotorua_TP =</span> <span class="st">"Lake Rotorua at Site 5 (Integrated)"</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="do">## if running a t-test</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">log</span>(rotoiti_rotorua_wide<span class="sc">$</span>Rotoiti_TP), <span class="fu">log</span>(rotoiti_rotorua_wide<span class="sc">$</span>Rotorua_TP))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  log(rotoiti_rotorua_wide$Rotoiti_TP) and log(rotoiti_rotorua_wide$Rotorua_TP)
t = 3.0868, df = 231.54, p-value = 0.00227
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 0.05506289 0.24940133
sample estimates:
mean of x mean of y 
-3.829669 -3.981901 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>rotoiti_rotorua_wide <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(Rotoiti_TP<span class="sc">:</span>Rotorua_TP, <span class="at">names_to =</span> <span class="st">"Site"</span>, <span class="at">values_to =</span> <span class="st">"TP"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Site, <span class="at">y =</span> <span class="fu">log</span>(TP), <span class="at">fill =</span> Site)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_compare_means</span>(<span class="at">method =</span> <span class="st">"wilcox.test"</span>, <span class="at">label =</span> <span class="st">"p.format"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite outside the scale range
(`stat_compare_means()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="do">## if running a wilcoxon test</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(rotoiti_rotorua_wide<span class="sc">$</span>Rotoiti_TP, rotoiti_rotorua_wide<span class="sc">$</span>Rotorua_TP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  rotoiti_rotorua_wide$Rotoiti_TP and rotoiti_rotorua_wide$Rotorua_TP
W = 8444.5, p-value = 0.003098
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>rotoiti_rotorua_wide <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(Rotoiti_TP<span class="sc">:</span>Rotorua_TP, <span class="at">names_to =</span> <span class="st">"Site"</span>, <span class="at">values_to =</span> <span class="st">"TP"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Site, <span class="at">y =</span> TP, <span class="at">fill =</span> Site)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">stat_compare_means</span>(<span class="at">method =</span> <span class="st">"wilcox.test"</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"p.format"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3 rows containing non-finite outside the scale range
(`stat_boxplot()`).
Removed 3 rows containing non-finite outside the scale range
(`stat_compare_means()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</details>
<hr>
</section>
<section id="anova" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="anova"><span class="header-section-number">4.3</span> ANOVA</h2>
<p>What if we have more than two variables we want to test for differences across? This is where the ANOVA, or ANalysis Of VAriance comes in. An ANOVA assumes that your response variable is normally distributed and you are comparing differences across <em>categorical</em> predictors.</p>
<p>In this example, we will use an ANOVA to test for differences in secchi depth across season in Lake Okaro.</p>
<p>We will go back to our <code>wq_okaro</code> dataset. First, we need to filter to just secchi depth data and clean a few things up. Then, we test to see if secchi depth is normally distributed, and if not, we will transform it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wq_okaro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Time Value  Parameter  Unit
1 2015-01-22 10:27:00 0.900 TN (g/m^3) g/m^3
2 2015-02-19 10:40:00 0.370 TN (g/m^3) g/m^3
3 2015-03-19 09:50:00 0.400 TN (g/m^3) g/m^3
4 2015-04-16 11:25:00 0.335 TN (g/m^3) g/m^3
5 2015-05-21 09:50:00 0.583 TN (g/m^3) g/m^3
6 2015-06-23 11:00:00 0.920 TN (g/m^3) g/m^3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>secchi_okaro <span class="ot">&lt;-</span> wq_okaro <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"VC - SD (m)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Unit, <span class="sc">-</span>Parameter) <span class="sc">%&gt;%</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">secchi_m =</span> Value)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(secchi_okaro<span class="sc">$</span>secchi_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(secchi_okaro<span class="sc">$</span>secchi_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  secchi_okaro$secchi_m
W = 0.94404, p-value = 0.0003429</code></pre>
</div>
</div>
<p>Looks like Secchi is not normally distributed, so we will create a new log-transformed column and run the shapiro test again to check.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>secchi_okaro <span class="ot">&lt;-</span> secchi_okaro <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">log_secchi_m =</span> <span class="fu">log</span>(secchi_m))</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(secchi_okaro<span class="sc">$</span>log_secchi_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(secchi_okaro<span class="sc">$</span>log_secchi_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  secchi_okaro$log_secchi_m
W = 0.97802, p-value = 0.09311</code></pre>
</div>
</div>
<p>P-value is greater than 0.05, so that looks better. We will run our ANOVA on log_secchi_m.</p>
<p>Next, we need to create out <code>seasons</code> column, which is the variable by which we want to test if there are differences in Secchi depth. We first create a <code>month</code> column, and then create the <code>season</code> column, which is based on the month. I’ll do this first for ‘Summer’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>secchi_okaro <span class="ot">&lt;-</span> secchi_okaro <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(Time)) <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Summer"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>__</p>
<p><strong><em>Challenge 8:</em></strong> <em>Now, finish creating the <code>season</code> column using <code>case_when</code> for “Autumn”, “Winter” and “Spring”. You will need to add <code>TRUE ~ season</code> as the last argument so that the values we set for Summer in the previous chunk of code remain (i.e., you’re not writing over your <code>summer</code> values you just did).</em></p>
<details>
<summary>
Click to see a solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>secchi_okaro <span class="ot">&lt;-</span> secchi_okaro <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Autumn"</span>, month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Winter"</span>, month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>) <span class="sc">~</span> <span class="st">"Spring"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> season))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<hr>
<p>Now that we have our <code>season</code> column, let’s make a boxplot of the data by season to see if there are any obvious patterns. We will order the season as a factor first to make sure it plots in an order that makes sense.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>secchi_okaro<span class="sc">$</span>season <span class="ot">&lt;-</span> <span class="fu">factor</span>(secchi_okaro<span class="sc">$</span>season, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Summer"</span>,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(secchi_okaro, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> secchi_m)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Secchi depth (m)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ok, there are some clear differences between the seasons here. I have a feeling this ANOVA is gonna be interesting…We will use the function <code>aov</code> to run the ANOVA on the log-transformed column and <code>summary</code> to look at the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>anova_secchi_okaro <span class="ot">&lt;-</span> <span class="fu">aov</span>(log_secchi_m <span class="sc">~</span> season, <span class="at">data =</span> secchi_okaro)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_secchi_okaro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
season       3  7.668  2.5561   11.31 2.02e-06 ***
Residuals   96 21.689  0.2259                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The Pr(&gt;F) is very small, which tells us that there is a significant differences between seasons for Secchi depth.</p>
<p>One last thing we can check is which seasons are different from each other. We can run a <code>Tukey</code> test to see this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>tukey_result <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(anova_secchi_okaro, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tukey_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = log_secchi_m ~ season, data = secchi_okaro)

$season
                    diff          lwr         upr     p adj
Summer-Spring  0.4014153  0.063513659  0.73931693 0.0130941
Autumn-Spring  0.7483003  0.410398707  1.08620198 0.0000005
Winter-Spring  0.3485858 -0.002656331  0.69982791 0.0525363
Autumn-Summer  0.3468850 -0.011875594  0.70564569 0.0619260
Winter-Summer -0.0528295 -0.424182046  0.31852304 0.9823365
Winter-Autumn -0.3997145 -0.771067094 -0.02836201 0.0297440</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(secchi_okaro, <span class="fu">aes</span>(<span class="at">x =</span> season, <span class="at">y =</span> <span class="fu">log</span>(secchi_m))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Secchi depth (m)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_5_2025_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looking at the p-adj column, we can see which seasons have statistically significant differences. Let’s use a p-value cutoff of p &lt; 0.05 is considered significant. Here, we can see that winter-spring, autumn-summer, and winter-summer are not statistically different from each other. If we look back at our boxplots, this looks like a reasonable result given the differences between distributions of those seasons.</p>
<p><em>Nice job! You’ve made it to the end of this statistical lesson. If you still have time, you can try running an ANOVA across seasons in another lake. Come to us with any questions!</em></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>